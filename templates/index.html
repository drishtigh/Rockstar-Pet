<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet Album Cover Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Pet Album Cover Generator</h1>
        <p>Let's create a rockstar persona for your pet.</p>
        
        <form id="pet-form" action="/generate" method="post" enctype="multipart/form-data">
            <div class="progress-bar">
                <div class="progress"></div>
            </div>

            <div class="question-container active" data-question="1">
                <div class="question-card">
                    <h2>Basic Info</h2>
                    <div class="question-box">
                        <label for="artist_name" class="question-text">What is your pet's name?</label>
                    </div>
                    <div class="answers-box">
                        <input type="text" id="artist_name" name="artist_name" required>
                    </div>
                    <div class="actions">
                        <button type="button" class="next-btn">Next</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="2">
                <div class="question-card">
                    <h2>Energy</h2>
                    <div class="question-box">
                        <label class="question-text">How energetic is your pet?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="energy" value="Chill"> Chill</label>
                            <label><input type="radio" name="energy" value="Balanced"> Balanced</label>
                            <label><input type="radio" name="energy" value="Zoomies Every Hour"> Zoomies Every Hour</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="3">
                <div class="question-card">
                    <h2>Vibe</h2>
                    <div class="question-box">
                        <label class="question-text">What's their overall vibe?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="vibe" value="Regal"> Regal</label>
                            <label><input type="radio" name="vibe" value="Goofball"> Goofball</label>
                            <label><input type="radio" name="vibe" value="Adventurer"> Adventurer</label>
                            <label><input type="radio" name="vibe" value="Snuggler"> Snuggler</label>
                            <label><input type="radio" name="vibe" value="Bossy"> Bossy</label>
                            <label><input type="radio" name="vibe" value="Wise Sage"> Wise Sage</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="4">
                <div class="question-card">
                    <h2>Social Personality</h2>
                    <div class="question-box">
                        <label class="question-text">How social are they?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="social" value="Shy"> Shy</label>
                            <label><input type="radio" name="social" value="Selective"> Selective</label>
                            <label><input type="radio" name="social" value="Party animal"> Party animal</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="5">
                <div class="question-card">
                    <h2>Wingman Activity</h2>
                    <div class="question-box">
                        <label class="question-text">Favorite wingman activity?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="wingman_activity" value="People-watching"> People-watching</label>
                            <label><input type="radio" name="wingman_activity" value="Park meetups"> Park meetups</label>
                            <label><input type="radio" name="wingman_activity" value="Supervising from a distance"> Supervising from a distance</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="6">
                <div class="question-card">
                    <h2>Signature Move</h2>
                    <div class="question-box">
                        <label class="question-text">Signature move?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="signature_move" value="Head tilt"> Head tilt</label>
                            <label><input type="radio" name="signature_move" value="Side-eye"> Side-eye</label>
                            <label><input type="radio" name="signature_move" value="Zoomies"> Zoomies</label>
                            <label><input type="radio" name="signature_move" value="Slow blink"> Slow blink</label>
                            <label><input type="radio" name="signature_move" value="Spooky stare"> Spooky stare</label>
                            <label><input type="radio" name="signature_move" value="Bread loaf"> Bread loaf</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="7">
                <div class="question-card">
                    <h2>Weirdest Habit</h2>
                    <div class="question-box">
                        <label class="question-text">Weirdest habit?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="weirdest_habit" value="Stealing socks"> Stealing socks</label>
                            <label><input type="radio" name="weirdest_habit" value="Staring at walls"> Staring at walls</label>
                            <label><input type="radio" name="weirdest_habit" value="Herding humans"> Herding humans</label>
                            <label><input type="radio" name="weirdest_habit" value="Vocal monologues"> Vocal monologues</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="8">
                <div class="question-card">
                    <h2>Play & Hobbies</h2>
                    <div class="question-box">
                        <label class="question-text">Favorite activity?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="favorite_activity" value="Chasing"> Chasing</label>
                            <label><input type="radio" name="favorite_activity" value="Fetch"> Fetch</label>
                            <label><input type="radio" name="favorite_activity" value="Puzzle toys"> Puzzle toys</label>
                            <label><input type="radio" name="favorite_activity" value="Sunbathing"> Sunbathing</label>
                            <label><input type="radio" name="favorite_activity" value="Bird TV"> Bird TV</label>
                            <label><input type="radio" name="favorite_activity" value="Box forts"> Box forts</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="9">
                <div class="question-card">
                    <h2>Affection & Boundaries</h2>
                    <div class="question-box">
                        <label class="question-text">Cuddle factor?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="cuddle_factor" value="Only when I decide"> Only when I decide</label>
                            <label><input type="radio" name="cuddle_factor" value="Sometimes"> Sometimes</label>
                            <label><input type="radio" name="cuddle_factor" value="Velcro"> Velcro</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="10">
                <div class="question-card">
                    <h2>Petting Rules</h2>
                    <div class="question-box">
                        <label class="question-text">Petting rules?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="petting_rules" value="Head only"> Head only</label>
                            <label><input type="radio" name="petting_rules" value="Belly traps"> Belly traps</label>
                            <label><input type="radio" name="petting_rules" value="All-access"> All-access</label>
                            <label><input type="radio" name="petting_rules" value="Don't touch the royal"> Don't touch the royal</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="11">
                <div class="question-card">
                    <h2>Mischief</h2>
                    <div class="question-box">
                        <label class="question-text">Sneakiness level?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="sneakiness" value="Law-abiding"> Law-abiding</label>
                            <label><input type="radio" name="sneakiness" value="Occasional heist"> Occasional heist</label>
                            <label><input type="radio" name="sneakiness" value="Master thief"> Master thief</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="12">
                <div class="question-card">
                    <h2>Communication</h2>
                    <div class="question-box">
                        <label class="question-text">Vocalness?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="vocalness_description" value="Silent film star"> Silent film star</label>
                            <label><input type="radio" name="vocalness_description" value="Chatty"> Chatty</label>
                            <label><input type="radio" name="vocalness_description" value="Opera"> Opera</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            <div class="question-container" data-question="13">
                <div class="question-card">
                    <h2>Favorite Sound</h2>
                    <div class="question-box">
                        <label class="question-text">Favorite sound?</label>
                    </div>
                    <div class="answers-box">
                        <div class="radio-group">
                            <label><input type="radio" name="favorite_sound" value="Purr/soft chirps"> Purr/soft chirps</label>
                            <label><input type="radio" name="favorite_sound" value="Barks/meows"> Barks/meows</label>
                            <label><input type="radio" name="favorite_sound" value="Snorts/bleps"> Snorts/bleps</label>
                            <label><input type="radio" name="favorite_sound" value="Dramatic sighs"> Dramatic sighs</label>
                        </div>
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="button" class="next-btn">Next</button>
                        <button type="button" class="skip-btn">Skip</button>
                    </div>
                </div>
            </div>

            

            <!-- Photo Treatment step removed (melodrama-only enforced in backend) -->

            <div class="question-container" data-question="14">
                <div class="question-card">
                    <h2>Album Artwork</h2>
                    <div class="question-box">
                        <label for="photos" class="question-text">Upload 1â€“5 photos of your pet:</label>
                    </div>
                    <div class="answers-box">
                        <input type="file" id="photos" name="photos" multiple accept="image/*">
                    </div>
                    <div class="actions">
                        <button type="button" class="back-btn">Back</button>
                        <button type="submit">Generate Poster</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('pet-form');
            const containers = Array.from(form.querySelectorAll('.question-container'));
            const progressBar = form.querySelector('.progress');
            let currentQuestionIndex = 0;
            const totalQuestions = containers.length;

            function updateProgress() {
                const progressPercent = ((currentQuestionIndex + 1) / totalQuestions) * 100;
                progressBar.style.width = progressPercent + '%';
            }

            function showQuestion(index) {
                containers.forEach((container, i) => {
                    container.classList.remove('active');
                    if (i === index) {
                        container.classList.add('active');
                    }
                });
                updateProgress();
                updateNextButtonState();
            }

            function updateNextButtonState() {
                const active = containers[currentQuestionIndex];
                const nextBtn = active.querySelector('.next-btn');
                if (!nextBtn) return; // last step has submit
                let enable = true;
                const reqText = active.querySelector('input[type="text"][required]');
                if (reqText) {
                    enable = reqText.value.trim().length > 0;
                }
                const radios = active.querySelectorAll('input[type="radio"]');
                if (radios.length) {
                    enable = Array.from(radios).some(r => r.checked);
                }
                nextBtn.disabled = !enable;
            }

            function nextQuestion() {
                const currentContainer = containers[currentQuestionIndex];
                const input = currentContainer.querySelector('input[type="text"][required]');
                if (input && !input.value.trim()) {
                    alert("Please enter your pet's name.");
                    return;
                }

                if (currentQuestionIndex < totalQuestions - 1) {
                    currentQuestionIndex++;
                    showQuestion(currentQuestionIndex);
                }
            }

            function prevQuestion() {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    showQuestion(currentQuestionIndex);
                }
            }

            // Handle Next and Skip button clicks
            form.addEventListener('click', function (e) {
                // Tile selection for answer boxes (radios hidden)
                const label = e.target.closest('.radio-group label');
                if (label) {
                    const input = label.querySelector('input[type="radio"]');
                    if (input) {
                        input.checked = true;
                        // Clear selection styles in this radio group
                        const group = form.querySelectorAll(`input[type="radio"][name="${input.name}"]`);
                        group.forEach(r => {
                            const lab = r.closest('label');
                            if (lab) lab.classList.remove('selected');
                        });
                        label.classList.add('selected');
                    }
                }
                const btn = e.target.closest('button');
                if (btn) {
                    if (btn.classList.contains('next-btn') || btn.classList.contains('skip-btn')) {
                        if (btn.classList.contains('next-btn') && btn.disabled) return;
                        nextQuestion();
                    } else if (btn.classList.contains('back-btn')) {
                        prevQuestion();
                    }
                }
                // Update Next state after any selection
                if (label) {
                    updateNextButtonState();
                }
            });

            // Text input validation for first step
            form.addEventListener('input', function (e) {
                if (e.target.matches('input[type="text"][required]')) {
                    updateNextButtonState();
                }
            });

            // Handle 'Enter' key press
            form.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent default form submission
                    
                    const activeContainer = containers[currentQuestionIndex];
                    const submitButton = activeContainer.querySelector('button[type="submit"]');
                    const nextBtn = activeContainer.querySelector('.next-btn');

                    if (submitButton) {
                        // If on the last question, submit the form
                        form.submit();
                    } else {
                        // Otherwise, go to the next question if enabled
                        if (nextBtn && !nextBtn.disabled) {
                            nextQuestion();
                        }
                    }
                }
            });

            // Initial setup
            showQuestion(currentQuestionIndex);

            // Initialize selected styles for any pre-checked radios
            form.querySelectorAll('input[type="radio"]').forEach(r => {
                if (r.checked) {
                    const lab = r.closest('label');
                    if (lab) lab.classList.add('selected');
                }
            });

            // Initialize Next button state
            updateNextButtonState();
        });
    </script>
</body>
</html>
