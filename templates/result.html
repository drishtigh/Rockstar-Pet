<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Pet's Album</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container" style="max-width:920px;">
        {% if cover_url %}
        <div style="margin: 16px 0; text-align:center;">
            <a href="{{ cover_url }}" download title="Download Poster">
                <img src="{{ cover_url }}" alt="Album poster" style="max-width:100%; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.15);"/>
            </a>
        </div>
        {% endif %}
        
        <!-- Single audio preview removed: only show per-track previews below -->

        {% if track_previews %}
        <div style="margin-top: 18px;">
            <h3>Track Previews</h3>
            <ol style="padding-left: 18px;">
                {% for tp in track_previews %}
                <li style="margin-bottom: 12px;">
                    <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                        <span style="font-weight:600; color:#333;">{{ tp.title }}</span>
                        {% if tp.exists %}
                        <audio class="track-audio" data-audio-id="{{ tp.audio_id }}" controls preload="none" style="flex:1; min-width:240px;">
                            {% for src in tp.sources %}
                            <source src="{{ src.url }}" type="{{ src.mime }}">
                            {% endfor %}
                            Your browser does not support the audio element.
                        </audio>
                        {% else %}
                        <span style="background:#fff7e6; border:1px dashed #f0ad4e; padding:6px 8px; border-radius:6px;">Missing audio: <code>static/audio/{{ tp.audio_id }}.mp3</code> or <code>{{ tp.audio_id }}.wav</code></span>
                        {% endif %}
                    </div>
                </li>
                {% endfor %}
            </ol>
            <script>
                (function(){
                    const LIMIT = 30; // seconds
                    const players = Array.from(document.querySelectorAll('.track-audio'));
                    players.forEach(a => {
                        a.addEventListener('play', () => {
                            // Pause all other players when one starts
                            players.forEach(other => {
                                if (other !== a && !other.paused) {
                                    other.pause();
                                    other.currentTime = 0;
                                }
                            });
                            if (a.currentTime > LIMIT) a.currentTime = 0;
                        });
                        a.addEventListener('timeupdate', () => {
                            if (a.currentTime >= LIMIT) { a.pause(); a.currentTime = 0; }
                        });
                    });
                })();
            </script>
        </div>
        {% endif %}
        <div style="text-align:center; margin-top:12px;">
            <a href="{{ cover_url }}" download class="btn">Download Poster</a>
            <span style="margin:0 8px;">â€¢</span>
            <a href="/" class="btn-secondary">Create another</a>
        </div>
    </div>
</body>
</html>
